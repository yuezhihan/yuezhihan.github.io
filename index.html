<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.4">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.4" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.0.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="Hexo, NexT" />


<meta name="description" content="Thinking...">
<meta property="og:type" content="website">
<meta property="og:title" content="岳知涵&#39;s Blog">
<meta property="og:url" content="http://yuezhihan.github.io/index.html">
<meta property="og:site_name" content="岳知涵&#39;s Blog">
<meta property="og:description" content="Thinking...">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="岳知涵&#39;s Blog">
<meta name="twitter:description" content="Thinking...">






  <link rel="canonical" href="http://yuezhihan.github.io/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>岳知涵's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">岳知涵's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Programming / Design / Philosophy</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yuezhihan.github.io/post/d2309e17.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhihan Yue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="岳知涵's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/d2309e17.html" itemprop="url">为什么L1正则化能产生稀疏性？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-18T18:43:00+08:00">2019-03-18</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>网上很多是用等高线来解释，这种解释显然不足以说明L1正则化产生稀疏性的原因</p>
<p>这里我给出一种更好的intuition</p>
<p>设J(X)=J1(X)+R(X)，J1是原来的cost函数，R是正则化因子</p>
<p>那么它们的导数也满足J’=J1’+R’</p>
<p>我们等价地认为，对于梯度下降的每次迭代，都包含两步：<br>S1. J -= alpha <em> J1’<br>S2. J -= alpha </em> R’</p>
<p>由于正则化的影响，X很容易到达0的附近</p>
<p>此后：</p>
<p>L1正则化始终坚定不移地把J推向0，|R’|始终不变，S2式的下降速度不变</p>
<p>而L2正则化，越接近x=0，|R’|就越小，这使得S2的更新小到相对于S1的更新可以忽略不计，在0的邻域内的更新就会被S1主宰，因此难以抵达0</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yuezhihan.github.io/post/93b436be.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhihan Yue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="岳知涵's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/93b436be.html" itemprop="url">如何从着色的角度直观理解CMYK的广阔色彩空间？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-13T15:17:47+08:00">2019-02-13</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们知道，色彩的三要素是色相、纯度、明度。</p>
<p>绘画时，通过颜料三原色的减色混合，可以得到各种各样的色相，这是常识，没有讨论的价值。但我们也会不禁想到这样一个问题：颜料本身具有的属性，仅仅是某种色相+某种纯度。当我们稀释颜料时，直观理解是稀释了颜料的纯度。那么，难道我们通过打印或者绘画，无法掌控明度吗？</p>
<p>我们首先想到明度的概念，直观理解，是一束光的明亮程度。</p>
<p>我把一幅画用手电筒照亮，实际上这幅画的明度就提高了。</p>
<p>似乎明度与光有关，难道我们用颜料时，对明度无能为力？</p>
<p>答案当然是否定的——我们用打印机打印的照片，纸张上确实可以反映出照片的明暗细节。</p>
<p>下面，我就对这个问题作出解释。</p>
<p>首先，我们需要理解的是，打印机中出墨量的调整，和绘画中颜料的稀释，本质上是一回事，都是在改变单位面积的颜料多少，也就是在改变颜料的密度。</p>
<p>当颜料密度增加时，色彩纯度当然会增加（毕竟纯度的意义就是密度），同时明度在这个过程中也在悄悄减少——颜料吸收了一部分光。</p>
<p>既然随着密度的改变，纯度和明度在同时改变，那还怎么调节？</p>
<p>其实，CMY颜料对光的吸收作用是非常温和的。</p>
<p>我们假设这张纸接受到的光为单位1（100%明度），可以理解为白纸的空白区域拥有100%的明度。当某种颜料出墨量达到饱和时（比如C100），色彩纯度升到100%，明度也仅仅降低了10%左右！</p>
<p>接下来我想进一步降低明度。一个直接的想法是：让颜料的量进一步增大，这样就能吸收更多的光。事实上，这就是CMYK颜色模式所采取的方式——混入黑色来吸收光。常见两种获得黑色的方式：一种是CMY等比例混合，一种是用Y，两种方式都可以在不改变纯度的情况下，使明度显著下降。</p>
<p>总而言之，通过CMYK出墨量的搭配，我们能够做到同时满足色彩纯度与明度的需求。</p>
<p>注：</p>
<ul>
<li>从HSB到CMYK的转换并不是打印机完成的，这种转换在计算机中就可以完成，这里只借它说明CMYK调色的直观原理（不涉及具体算法）</li>
<li>文中提到，明度和饱和度在一开始有短暂的同时变化的过程，这意味着CMYK颜色模式具有“盲区”——它并不能够描述所有颜色。的确如此，CMYK的“盲区”主要位于一些高饱和度高明度的区域，且范围较小。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yuezhihan.github.io/post/7acfed82.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhihan Yue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="岳知涵's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/7acfed82.html" itemprop="url">浅谈鼻音与鼻腔共鸣的关系</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-24T00:37:03+08:00">2018-12-24</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>从收集到的资料来看，这是一个非常有争议的问题——<br>1.世界著名男中音基诺贝基说过“到高音多用鼻子是听不出来的，谁也说不清面罩和鼻音是怎么回事。”<br>2.“前鼻音是我们通常理解的鼻音，后鼻音就是鼻腔共鸣”<br>3.意大利声乐专家莉莉·雷耶斯（Lilia Leies），在1985年面对一位听起来“鼻音较重”的学员时，兴奋地说：“好！你发声的基本功不错，声音已进入面罩，我很喜欢你的唱法。”（刘中连，《如何获得歌唱的高音——兼谈声乐教学心理与教学法的思路》，2013）</p>
<p>我认为，鼻音是一种特殊的鼻腔共鸣。正常说话，前后鼻音发声时，舌头总会阻塞口腔的气流，使口腔共鸣减弱，更多气流进入鼻腔，鼻腔因为气流冲击扩大，使鼻腔共鸣增强，因此产生了“鼻音”。<br>￼<br><img src="/post/7acfed82/biyin.png" title="鼻音原理"></p>
<p>什么是鼻音过重？“鼻音过重”指的是鼻腔共鸣不正常所产生的不自然的感受，过弱、过强、该有的时候没有、不该有的时候有，都属于鼻音过重。常见的有以下三种：</p>
<ul>
<li>口腔共鸣弱：发声时嘴巴没张开，气流大部分从鼻子经过</li>
<li>闭塞性鼻音：空气不连通使鼻腔共鸣减弱。当鼻塞时，就会出现这种情况</li>
<li>开放性鼻音：说话时鼻咽腔该闭合时不闭合，始终处于开放状态（唱歌时这样是正常的，可以产生所需要的鼻腔共鸣）</li>
</ul>
<p>在获得鼻腔共鸣的同时，避免“鼻音过重”的关键是</p>
<ul>
<li>打开鼻腔后面的空间（鼻咽腔）</li>
<li>张嘴，保证口腔的开度</li>
</ul>
<p>===</p>
<p>Q：发鼻腔共鸣时鼻子需要出气吗？<br>A：鼻腔共鸣的产生与鼻子是否出气无关，与鼻咽腔是否通气有关，空气只要是连通的没有阻塞的理论上就可以产生共鸣。不可否认当鼻腔气流大的时候，会把共鸣腔体撑开，从而使鼻腔共鸣增强，但口腔共鸣相应的就减小了，需要调整好这个比例。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yuezhihan.github.io/post/da9c6174.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhihan Yue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="岳知涵's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/da9c6174.html" itemprop="url">Best Require —— node多层级相对路径引用最佳解决方案</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-01T09:46:03+08:00">2018-03-01</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这是我编写的一个node.js插件，发布于npm，用于解决多层级相对路径模块引用难以维护的问题，具体看下面的「Introduction」。</p>
<p><a href="https://www.npmjs.com/package/best-require" target="_blank" rel="noopener"><img src="https://img.shields.io/npm/v/best-require.svg" alt="NPM version"></a></p>
<p><strong>Best Require</strong> is a <code>require()</code> hook plugin for requiring a module in your project elegantly for Node.js.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">':controllers/posts'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">':models/Users'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'~/application/apis/config'</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install best-require --save</span><br></pre></td></tr></table></figure>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><h4 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h4><p>Have you ever coded like this in your application?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// require the 'posts' module</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./posts'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./controllers/posts'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'../controllers/posts'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'../../controllers/posts'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'../../../apis/controllers/posts'</span>);</span><br></pre></td></tr></table></figure>
<p>When our project contains many layers of directory, the relative path of each module will become complicated, which not only makes us very confused, but also makes the project difficult to maintain.</p>
<p>When faced with the problem, you might tend to find a unified way to access the <code>posts</code> module, just like me. I used to require modules in this way:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(ROOT_PATH + <span class="string">'/application/apis/controllers/posts'</span>);</span><br><span class="line"><span class="comment">// other require()...</span></span><br><span class="line"><span class="built_in">require</span>(ROOT_PATH + <span class="string">'/application/apis/controllers/users'</span>);</span><br><span class="line"><span class="built_in">require</span>(ROOT_PATH + <span class="string">'/application/apis/controllers/products'</span>);</span><br><span class="line"><span class="built_in">require</span>(ROOT_PATH + <span class="string">'/application/apis/services/rest'</span>);</span><br><span class="line"><span class="built_in">require</span>(ROOT_PATH + <span class="string">'/application/apis/config'</span>);</span><br></pre></td></tr></table></figure>
<p>ummmm… It’s more maintainable than before. But, <code>ROOT_PATH</code> is ugly, isn’t it?</p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p>Let’s try to use <strong>Best Require</strong>, by adding this at the beginning of the app:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'best-require'</span>)(process.cwd())</span><br></pre></td></tr></table></figure>
<p>Now, we can use <code>~</code> to represent <code>process.cwd()</code> in the path:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'~/application/apis/controllers/posts'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'~/application/apis/controllers/users'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'~/application/apis/controllers/products'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'~/application/apis/services/rest'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'~/application/apis/config'</span>);</span><br></pre></td></tr></table></figure>
<p>However, this directory name is still a bit long, which can be shortened by defining the name mapping:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ROOT_PATH = process.cwd();</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'best-require'</span>)(ROOT_PATH, &#123;</span><br><span class="line">    apis: ROOT_PATH + <span class="string">'/application/apis'</span>,</span><br><span class="line">    controllers: ROOT_PATH + <span class="string">'/application/apis/controllers'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Then we are able to use <code>:apis</code> for <code>~/application/apis</code> and <code>:controllers</code> for <code>~/application/apis/controllers</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">':controllers/posts'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">':controllers/users'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">':controllers/products'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">':apis/services/rest'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">':apis/config'</span>);</span><br></pre></td></tr></table></figure>
<p>With the release V1.1+, you can also use other keys in the definition of a key-value pair in the name mapping, and our plug-in will automatically handle the keys’ dependencies on each other. Therefore, the definition can be simplified as:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'best-require'</span>)(ROOT_PATH, &#123;</span><br><span class="line">    apis: <span class="string">'~/application/apis'</span>,</span><br><span class="line">    controllers: <span class="string">':apis/controllers'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>Add this at the beginning of the program:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'best-require'</span>)(</span><br><span class="line">    root_path, <span class="comment">// [optional] project root directory, defaults to `process.cwd()`</span></span><br><span class="line">    name_mapping <span class="comment">// [optional] name mapping</span></span><br><span class="line">)();</span><br></pre></td></tr></table></figure>
<p>Then you can use:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'~/(path)'</span>); <span class="comment">// require(root_path + '/(path)');</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">':key/(path)'</span>); <span class="comment">// require(name_mapping[key] + '/(path)');</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yuezhihan.github.io/post/2c258124.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhihan Yue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="岳知涵's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/2c258124.html" itemprop="url">npm uninstall sequelize --save</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-26T01:17:05+08:00">2018-02-26</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先前使用sequelize，是因为它在github上的star是node orm当中最多的，生态比较好。</p>
<p>在框架开发过程中，放弃sequelize，倒不是因为遇到了不适合使用sequelize的业务场景（当然众所周知不适合用orm的情况是存在的），而是因为它不太美。</p>
<p>对sequelize的模型扩展，比较官方的做法是：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">User = sequelize.define(<span class="string">'User'</span>, &#123;</span><br><span class="line">  name:     &#123; <span class="attr">type</span>: DataTypes.STRING &#125;,</span><br><span class="line">  email:    &#123; <span class="attr">type</span>: DataTypes.STRING, <span class="attr">unique</span>: <span class="literal">true</span>, <span class="attr">allowNull</span>: <span class="literal">false</span>, <span class="attr">validate</span>: &#123;<span class="attr">notEmpty</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">    set: <span class="function"><span class="keyword">function</span>(<span class="params">email</span>)  </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.setDataValue(<span class="string">'email'</span>, email.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  role:     &#123; <span class="attr">type</span>: DataTypes.STRING, <span class="attr">defaultValue</span>: <span class="string">'user'</span> &#125;,</span><br><span class="line">  password: &#123; <span class="attr">type</span>: DataTypes.STRING, <span class="attr">allowNull</span>: <span class="literal">false</span>, <span class="attr">validate</span>: &#123;<span class="attr">notEmpty</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">    set: <span class="function"><span class="keyword">function</span>(<span class="params">password</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.salt = <span class="keyword">this</span>.makeSalt();</span><br><span class="line">      <span class="keyword">this</span>.setDataValue(<span class="string">'password'</span>, <span class="keyword">this</span>.encryptPassword(password));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  provider: &#123; <span class="attr">type</span>: DataTypes.STRING &#125;,</span><br><span class="line">  salt:     &#123; <span class="attr">type</span>: DataTypes.STRING &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  getterMethods: &#123;</span><br><span class="line">    profile: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        name: <span class="keyword">this</span>.name,</span><br><span class="line">        role: <span class="keyword">this</span>.role</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  instanceMethods: &#123;</span><br><span class="line">    authenticate: <span class="function"><span class="keyword">function</span>(<span class="params">plainText</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.encryptPassword(plainText) === <span class="keyword">this</span>.password;</span><br><span class="line">    &#125;,</span><br><span class="line">    makeSalt: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> crypto.randomBytes(<span class="number">16</span>).toString(<span class="string">'base64'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    encryptPassword: <span class="function"><span class="keyword">function</span>(<span class="params">password</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!password || !<span class="keyword">this</span>.salt) <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">      <span class="keyword">var</span> salt = <span class="keyword">new</span> Buffer(<span class="keyword">this</span>.salt, <span class="string">'base64'</span>);</span><br><span class="line">      <span class="keyword">return</span> crypto.pbkdf2Sync(password, salt, <span class="number">10000</span>, <span class="number">64</span>).toString(<span class="string">'base64'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>自行感受一下这密密麻麻的大括号……</p>
<p>这其实还好，新版本中<code>classMethods and instanceMethods are removed</code>，那岂不是很丑了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Class Method</span></span><br><span class="line">Model.associate = <span class="function"><span class="keyword">function</span> (<span class="params">models</span>) </span>&#123;</span><br><span class="line">    ...associate the models</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Instance Method</span></span><br><span class="line">Model.prototype.someMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;..&#125;</span><br></pre></td></tr></table></figure>
<p>这个Breaking Change让我感觉回到了没有ES6的年代。</p>
<p>这审美。。。从rails转过来的我当然不能忍啊，自作聪明觉得把model写成class会比较优雅，并且易于扩展：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> User = db.define(<span class="string">'user'</span>, &#123;</span><br><span class="line">    username: &#123;</span><br><span class="line">        type: db.STRING(<span class="number">30</span>),</span><br><span class="line">        validate: &#123; <span class="attr">notEmpty</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    password_digest: &#123;</span><br><span class="line">        type: db.STRING(<span class="number">80</span>),</span><br><span class="line">        validate: &#123; <span class="attr">notEmpty</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    email: db.STRING(<span class="number">50</span>),</span><br><span class="line">    phonenum: db.STRING(<span class="number">30</span>),</span><br><span class="line">    university: db.STRING(<span class="number">50</span>),</span><br><span class="line">    stu_num: db.STRING(<span class="number">30</span>),</span><br><span class="line">    role: db.INTEGER</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(obj) &#123;</span><br><span class="line">        <span class="keyword">super</span>(obj);</span><br><span class="line">        <span class="keyword">this</span>.role = obj.role || <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    setPassword(pass) &#123;</span><br><span class="line">        <span class="keyword">const</span> salt = randomString(SALT_LENGTH);</span><br><span class="line">        <span class="keyword">this</span>.password_digest = salt + md5(salt + md5(pass));</span><br><span class="line">    &#125;</span><br><span class="line">    authenticate(pass) &#123;</span><br><span class="line">        <span class="keyword">const</span> salt = <span class="keyword">this</span>.password_digest.substring(<span class="number">0</span>, SALT_LENGTH);</span><br><span class="line">        <span class="keyword">return</span> salt + md5(salt + md5(pass)) === <span class="keyword">this</span>.password_digest;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">async</span> _seeds() &#123; </span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>马上坑就来了！定义<code>relationship</code>时，使用继承后的<code>User</code>类来定义是无效的（没有任何提示，悄无声息就没卵用了），用继承前的（<code>sequelize.define()</code>的返回值）一切正常，OK，那加个<code>__proto__</code>总行了吧……</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">files.forEach(<span class="function">(<span class="params">f</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!f.startsWith(<span class="string">'_'</span>) &amp;&amp; f.endsWith(<span class="string">'.js'</span>)) &#123;</span><br><span class="line">        <span class="keyword">let</span> name = f.substring(<span class="number">0</span>, f.length - <span class="number">3</span>);</span><br><span class="line">        name = name.split(<span class="string">'-'</span>).map(<span class="function">(<span class="params">f</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> f.substring(<span class="number">0</span>, <span class="number">1</span>).toUpperCase() + f.substring(<span class="number">1</span>).toLowerCase();</span><br><span class="line">        &#125;).join(<span class="string">''</span>);</span><br><span class="line">        models[name] = <span class="built_in">require</span>(<span class="string">':models/'</span> + f).__proto__; <span class="comment">// &lt;--- __proto__ here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// ............</span></span><br><span class="line">User.hasMany(Token);</span><br><span class="line">Token.belongsTo(User);</span><br></pre></td></tr></table></figure>
<p>OK，看起来一切正常了，但可别高兴太早……又发现一个坑，没有进行任何更新直接写回，居然会调用INSERT语句而不是UPDATE。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = <span class="keyword">await</span> User.findById(ctx.request.body.uid);</span><br><span class="line">user.save();</span><br></pre></td></tr></table></figure>
<p>断点跟进去发现，<code>user.isNewRecord</code>为true（因为它认为是新记录，所以就INSERT了），而我用<code>User.__proto__.findById</code>时，<code>user.isNewRecord</code>为false，程序正常工作……</p>
<p><strong>“优雅改造计划” —— 失败</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall sequelize --save</span><br></pre></td></tr></table></figure>
<p>============</p>
<p>emmmmm算了，先用sequelize把这个项目写完，证明我用过，下个项目就告别sequelize。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yuezhihan.github.io/post/e10a1b34.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhihan Yue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="岳知涵's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/e10a1b34.html" itemprop="url">为什么我反对清除node.js中require的cache？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-07T18:13:51+08:00">2018-01-07</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我曾经尝试用这种方式写module：<strong>“始终假设cache不存在，保证开发者在多次require时是否清除cache对module的工作没有影响”</strong>，后来发现与其这样不如禁止清除cache这种行为。</p>
<p>现在让我们设想“没有cache”的情形（这也是我这么实践时遇到的坑）：</p>
<ul>
<li>我们无法在module中直接写初始化代码（因为这样会导致多次require会进行多次初始化）；</li>
<li>在module闭包中声明的变量，对于内部的一些function而言，不能视为“静态变量”，这种情况是反直觉的，因此容易造成错误（想避免“错误”需要用额外的设计模式进行约束）；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> ++x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>对于需要初始化并且只能初始化一次的module，需要告诉某个和它交互的单例对象（比如‘app’module），它初始化完了；然后，module的每一次执行都询问那个对象，我是否已经初始化了，如果是就不用再次初始化，为什么会这样，因为这个module本身没有记录任何信息（module层面上没有传统意义上的“静态变量”），信息完全来自于外部；当然还有一种做法，直接由外部对此模块进行初始化（比方说module1.init()），但这不利于代码逻辑的分离，并且对此模块的ref可能还需要通过其他模块（初始化了它的模块）获得；</li>
<li>难以支持多入口的工程：总要有模块实际负责保存动态数据，不然程序怎么执行？显然，这样的模块只能是入口，就一个main入口的话还好，一层层往下写很OK，但假如我想加入另一个入口test，那么假如某模块（这样的模块必定存在）原本与main入口通信（从它那里知道它有没有初始化完成之类的），现在是不是还需要修改这个模块的代码使它与test通信？或者去调用main入口？这种情况下，工程最好只有一个入口，并通过一种十分不灵活的方式建构；</li>
<li>循环依赖；</li>
</ul>
<p>就理想而言，我能想到的彻底的解决方案有两种：</p>
<ol>
<li>把清除cache视为一类“hack”方式，从规范上讲，就应该是有cache的，清除了cache能不能用我不负责，如果遇到了看似需要清除cache才能解决的问题，请尝试改变自己的设计模式，而不是清除cache。</li>
<li>加入能直接实现module级别的static变量的语言特性，这样module就有了状态，有没有cache就无所谓了。</li>
</ol>
<p>就现状而言，我认为：在编写module时，尽量假设处在没有cache（假如真的反复执行了也没影响）的情形中，是比较好的。<strong>但如果做这件事需要任何额外的工作甚至对工程逻辑结构的调整，那就千万不要这么做！</strong> 人对工程逻辑结构的思考和理解，应严格优先于这个不成熟的规则。</p>
<p>欢迎讨论！</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yuezhihan.github.io/post/c9c527d3.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhihan Yue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="岳知涵's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/c9c527d3.html" itemprop="url">对C++临时对象的内存位置的研究</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-20T14:28:21+08:00">2017-08-20</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>首先，这是一个很少有人研究的问题：C++的临时对象是在堆里还是在栈里的。<br>但若不研究清楚内部原理，每次产生临时量时都会纠结于此，<br>网上能找到的资料也都是new在堆里、定义在函数内部就是栈里，或者是临时量通过复制构造函数构造这种废话。<br>所以自己研究了一下……</p>
<p>首先，运算中的临时对象显然是栈内的，<br>对于参数上的临时对象，我推测是直接push进去的，应该也在栈内，<br>但是返回值上的临时对象就很让人费解了，应该是用rax传的地址，空间从哪来的呢。。<br>如果是new出来的空间，调用方如何确定合适的时机来delete以免内存泄漏？<br>如果是在函数栈内的，那函数结束后就不能保证原栈空间不被覆盖了。。。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">test</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> a,b;</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> asd;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">test <span class="title">f</span><span class="params">(test aaa)</span> </span>&#123;</span><br><span class="line">  test faf=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">return</span> faf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">()</span> </span>&#123;</span><br><span class="line">test k;</span><br><span class="line">  f(k);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">g();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对三个函数反汇编看看。</p>
<p>f函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pushq %rbp</span><br><span class="line">movq %rsp, %rbp</span><br><span class="line">movq %rdi, %rax</span><br><span class="line">movq %rsi, %rcx</span><br><span class="line">movq %rcx, %rdx</span><br><span class="line">movq %rax, -32(%rbp)</span><br><span class="line">movq %rdx, -24(%rbp)</span><br><span class="line">movq $0, -16(%rbp)</span><br><span class="line">movq $0, -8(%rbp)</span><br><span class="line">movq -16(%rbp), %rax</span><br><span class="line">movq -8(%rbp), %rdx</span><br><span class="line">popq %rbp</span><br><span class="line">ret</span><br></pre></td></tr></table></figure></p>
<p>g函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pushq %rbp</span><br><span class="line">movq %rsp, %rbp</span><br><span class="line">subq $16, %rsp</span><br><span class="line">movq -16(%rbp), %rdx</span><br><span class="line">movq -8(%rbp), %rax</span><br><span class="line">movq %rdx, %rdi</span><br><span class="line">movq %rax, %rsi</span><br><span class="line">call f(test)</span><br><span class="line">nop</span><br><span class="line">leave</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>
<p>main函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pushq %rbp</span><br><span class="line">movq %rsp, %rbp</span><br><span class="line">call g()</span><br><span class="line">movl $0, %eax</span><br><span class="line">popq %rbp</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>
<p>妙哉！！原来在函数g()中为返回值预留了栈空间，然后居然将g()的栈空间地址push进去了（我以前一直认为C++的隐含参数只有this）。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yuezhihan.github.io/post/30454152.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhihan Yue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="岳知涵's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/30454152.html" itemprop="url">“活”的模拟退火算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-27T17:07:05+08:00">2017-07-27</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>看到网上很多人只会用”死”的模拟退火算法，网上的资料也全是”死”的模拟退火算法，所以我来说一说<strong>“活”的模拟退火算法</strong>……</p>
<p>大家都知道算法步骤：先取一个初始状态集合和一个足够大的温度T，若T没有降到Tmin，对于集合中的每个状态，求出它能扩展出的最优状态，若更优则替换原解，否则以e的ΔE/T次方的概率替换原解，取最优解作为答案<br>当具体到某个实际问题时，这样可能不能起到好的效果，不是每个问题都是让你”退火”的！！</p>
<p>我要说的是”退火”的思想和本质！！<br>模拟退火算法的具有智能的地方是<strong>考虑了”非更优解能扩展出更优解的概率”</strong>，这种概率在”非退火”问题上未必是e的ΔE/T次方，未必随T升高而升高，随ΔE的绝对值的升高而降低，我们完全有权利改造这个概率函数，使得它能解决其他问题。</p>
<p><strong>思考非更优解扩展出更优解的概率变化，与哪些量呈正相关，与哪些量呈负相关？</strong><br>当概率与温度成正相关，与评价函数差的绝对值成负相关时，就和狭义的模拟退火算法一样，<br>否则可以自己设计概率函数，这是广义的模拟退火算法。<br>若此概率不和温度相关，就不要判温度了！<br>若非更优解扩展出更优解的概率是0，那就又可以<strong>欢乐地爬山</strong>了。</p>
<p>同样地，算法终止条件也未必是温度降到了某个值，<strong>要根据当前解为最优解的时机来考虑</strong>，甚至也可以搞一个概率，很随意的。。学东西不要学死了！！如果说的不对请轻喷… </p>
<p><strong>以上不是重点，下面才是重点，能解决很多几何问题的神器——变步长爬山！很多情况下能替代模拟退火。</strong><br>更神的算法（很多人把它叫做模拟退火，这实际上不是模拟退火，而是变步长爬山……）<br>我们想象在一个三维的空间内，有一个山脉的地形图，有山峰和山谷，越高表示这个位置的值越优，<br>如果这个图中山峰非常密集，忽高忽低，乱七八糟，到处都是”尖塔”和”裂缝”，就没什么启发信息了，别想用启发式搜索了！<br>当然这种情况很少见，一个问题中往往总会有些量是渐变的。。<br>否则可以直接搞多人变步长爬山，人数大概是山峰的个数*2（个人经验），<br>这样非常简单非常暴力，其AC率远远高于用不合理的概率函数的AC率……<br>个人认为，变步长爬山是先大步后小步，与模拟退火的先大概率接受后小概率接受有很大的内在联系。<br>如果是离散的，不知道这个状态扩展N次（步长）后的状态是什么，那就只能模拟退火了囧。。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yuezhihan.github.io/post/6473908f.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhihan Yue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="岳知涵's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/6473908f.html" itemprop="url">最大权闭合子图的简单证明</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-29T11:55:20+08:00">2017-06-29</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以前只会写，没证明过，搜了一下网上的证明，太复杂了，<br>我并不是说公式化的严谨的证明不好，而是认为那种证明不利于直观的理解，<br>常常有这样的情况：看证明每一步都很正确，但是以后你没办法用几句话概括对这个式子的理解，你也不知道这样证明的思想是什么，主要原因是证明太复杂，难于从整体上去把握，这样也不利于根据理解推广出新的结论。<br>从某种意义上说，白话点的简要证明更利于直观的理解，所以我试着自己证明了一下：</p>
<p>我简要证明了下最大权闭合子图，没有引入简单割等概念——<br>求证：设最小割为[S,T]，则选的点的集合为S-{s}有最优性，且最优值为正权点和-最小割。<br>证明：∵最小割必不包含正无穷的边，∴最小割集中的边(u,v)一定满足u=s或v=t。<br>∵对于最小割集中的任一条边(u,v)，均满足u属于S，且v属于T，（[S,T]割的基本性质）<br>∴S-{s}={s附近没被割的点}∪{t附近被割的点}={没被割的正权点}∪{被割的负权点}<br>则 解=正权点和-被割的正权点+(-被割的负权点)=正权点和-最小割值<br>最小割是最小值，则此时解一定是最大值。证毕。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yuezhihan.github.io/post/c79cc912.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhihan Yue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="岳知涵's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/c79cc912.html" itemprop="url">最长上升子序列的O(nlgn)解法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-03T19:17:23+08:00">2017-05-03</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>感觉网上说的太复杂了……</p>
<p>今天我突然想明白了，写起来不过三行代码而已。</p>
<p>首先换一种状态表示：设f[i]为长度为i的上升子序列中末尾元素的最小值，<br>初始化f[0]=INT_MIN，f[1~N]=INT_MAX<br>然后对于每个元素，更新集合 { f[i] | f[i-1] &lt; a[j] } 中的所有f[i]的最小值，<br>以上方法O(n^2)</p>
<p>由于f[i-1] &lt; a[j]（上面集合中的条件），<br>所以用于更新的a[j]一定比更新上一位置的那玩意大，所以f数组单调递增，<br>前面比a[j]小的更新不走，只有更新中间那个位置的，<br>或者说对于一个a[j]，只可能更新一个，就是上一个还小的，下一个就比它大的那个，</p>
<p>用二分优化更新过程 O(nlgn)</p>
<p>实现比O(n^2)的方法还简单！只需要三行代码！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fill(f,f+n,INT_MAX);</span><br><span class="line">for(int i=0;i&lt;n;++i)</span><br><span class="line">    *lower_bound(f,f+n,a[i])=a[i];</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Zhihan Yue</p>
              <p class="site-description motion-element" itemprop="description">Thinking...</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhihan Yue</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.0.4</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.4"></script>



  



	





  





  






<!-- LOCAL: You can save these files to your site and update links -->

  
  <link rel="stylesheet" href="/gitmint/style/default.css">
  <script src="/gitmint/dist/gitmint.browser.js"></script>

<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    






  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
